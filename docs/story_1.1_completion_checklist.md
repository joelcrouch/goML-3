# Story 1.1: Multi-Cloud Infrastructure Setup - Completion Checklist

**Story Points**: 8
**Status**: Scripts created, ready for execution
**Date**: 2025-10-19

---

## Overview

Story 1.1 focuses on provisioning and verifying the multi-cloud infrastructure required for the Raft cluster. This checklist tracks completion of all acceptance criteria.

---

## Acceptance Criteria

### ‚úÖ Infrastructure Provisioned

- [x] **3 AWS EC2 instances** deployed (t4g.small, ARM64, Amazon Linux 2)
- [x] **2 GCP Compute instances** deployed (e2-medium, AMD64, Debian 11)
- [x] Security groups/firewalls configured (SSH port 22, App port 8080)
- [x] Go 1.21.0 installed on all nodes
- [ ] inventory.ini created with all node IPs

**Status**: Infrastructure deployed via Terraform (confirmed in task description)

---

### üîÑ Scripts and Tools Created

- [x] **verify_connectivity.sh** - Cross-cloud connectivity verification
  - Location: `scripts/verify_connectivity.sh`
  - Purpose: Test ICMP and TCP connectivity between all nodes
  - Status: Created, executable

- [x] **setup_raft_storage.yml** - Ansible playbook for Raft storage
  - Location: `ansible/setup_raft_storage.yml`
  - Purpose: Create persistent directories for Raft logs/snapshots
  - Status: Created, ready to run

- [x] **generate_node_configs.py** - Node configuration generator
  - Location: `scripts/generate_node_configs.py`
  - Purpose: Generate node-specific JSON configs
  - Status: Created, executable

- [x] **measure_latency.sh** - Network latency measurement
  - Location: `scripts/measure_latency.sh`
  - Purpose: Measure and document baseline latencies
  - Status: Created, executable

- [x] **infrastructure_setup_guide.md** - Complete setup documentation
  - Location: `docs/infrastructure_setup_guide.md`
  - Purpose: Step-by-step execution guide
  - Status: Created

---

### ‚è≥ Execution Steps (To Be Run)

#### Step 1: Verify Cross-Cloud Connectivity
```bash
export KEY_NAME="multi-cloud-key"
export GCP_USER_NAME="yourusername"
./scripts/verify_connectivity.sh
```

**Expected Result**:
- [ ] All nodes can ping each other (ICMP)
- [ ] TCP port 8080 reachable (may show "no listener" - expected)

---

#### Step 2: Setup Raft Persistent Storage
```bash
ansible-playbook -i inventory.ini ansible/setup_raft_storage.yml
```

**Expected Result**:
- [ ] `/var/lib/raft/` directories created on all 5 nodes
- [ ] `/etc/raft/` directories created on all 5 nodes
- [ ] Correct ownership and permissions set

---

#### Step 3: Generate Node Configurations
```bash
python3 scripts/generate_node_configs.py
```

**Expected Result**:
- [ ] 5 JSON config files in `config/nodes/`
- [ ] `scripts/deploy_configs.sh` auto-generated

---

#### Step 4: Deploy Node Configurations
```bash
./scripts/deploy_configs.sh
```

**Expected Result**:
- [ ] Config files copied to all nodes
- [ ] Files placed in `/etc/raft/config.json`

---

#### Step 5: Measure Baseline Latency
```bash
./scripts/measure_latency.sh
```

**Expected Result**:
- [ ] `docs/baseline_latency.md` created
- [ ] Latency matrix populated with measurements
- [ ] Intra-cloud: <5ms
- [ ] Cross-cloud: 50-100ms

---

## Performance Targets

### Network Latency
| Connection Type | Target | Acceptable Range |
|-----------------|--------|------------------|
| AWS ‚Üí AWS | <5ms | 1-10ms |
| GCP ‚Üí GCP | <5ms | 1-10ms |
| AWS ‚Üí GCP | 50-100ms | 40-150ms |

### Infrastructure Specs
| Component | AWS Nodes (3) | GCP Nodes (2) |
|-----------|---------------|---------------|
| Instance Type | t4g.small | e2-medium |
| Architecture | ARM64 | AMD64 |
| OS | Amazon Linux 2 | Debian 11 |
| vCPU | 2 | 2 |
| RAM | 2GB | 4GB |
| Go Version | 1.21.0+ | 1.21.0+ |

---

## Deliverables Checklist

### Code/Scripts
- [x] `scripts/verify_connectivity.sh`
- [x] `scripts/generate_node_configs.py`
- [x] `scripts/measure_latency.sh`
- [x] `ansible/setup_raft_storage.yml`
- [ ] `scripts/deploy_configs.sh` (auto-generated by step 3)

### Configuration Files
- [ ] `config/nodes/aws-node-1.json`
- [ ] `config/nodes/aws-node-2.json`
- [ ] `config/nodes/aws-node-3.json`
- [ ] `config/nodes/gcp-node-1.json`
- [ ] `config/nodes/gcp-node-2.json`

### Documentation
- [x] `docs/infrastructure_setup_guide.md`
- [x] `docs/story_1.1_completion_checklist.md` (this file)
- [ ] `docs/baseline_latency.md` (generated by step 5)

### Infrastructure
- [x] Terraform configuration
- [x] 5 VMs deployed and running
- [ ] inventory.ini created

---

## Validation Tests

Before marking Story 1.1 complete, verify:

### Connectivity Tests
```bash
# From any AWS node, test reach to all others
ssh -i ~/.ssh/${KEY_NAME}.pem ec2-user@<AWS_IP> "ping -c 3 <OTHER_IP>"

# Verify SSH access to all nodes
for ip in <ALL_IPS>; do
    ssh -i ~/.ssh/${KEY_NAME}.pem <USER>@$ip "hostname"
done
```

### Storage Tests
```bash
# Verify Raft directories exist
ssh -i ~/.ssh/${KEY_NAME}.pem ec2-user@<AWS_IP> "ls -la /var/lib/raft/"

# Verify permissions
ssh -i ~/.ssh/${KEY_NAME}.pem ec2-user@<AWS_IP> "stat /var/lib/raft/"
```

### Configuration Tests
```bash
# Verify config deployed
ssh -i ~/.ssh/${KEY_NAME}.pem ec2-user@<AWS_IP> "cat /etc/raft/config.json"

# Check peer count (should be 4 for each node)
ssh -i ~/.ssh/${KEY_NAME}.pem ec2-user@<AWS_IP> \
    "cat /etc/raft/config.json | grep -o '\"peers\"' | wc -l"
```

---

## Known Issues and Notes

### Issue: inventory.ini not auto-generated
**Workaround**: Create manually using Terraform outputs
```bash
cd terraform
terraform output aws_instance_public_ips
terraform output gcp_instance_public_ips
# Copy IPs into inventory.ini
```

### Note: Security Group Configuration
Ensure the following ports are open:
- **22**: SSH (for management)
- **8080**: Raft consensus (TCP)
- **50051**: gRPC (for Python agents)
- **ICMP**: For ping tests

### Note: SSH Key Permissions
```bash
chmod 400 ~/.ssh/${KEY_NAME}.pem
```

### Note: Variable Substitution
Replace the following placeholders:
- `${KEY_NAME}`: Your SSH key name (e.g., "multi-cloud-key")
- `${GCP_USER_NAME}`: Your GCP Linux username
- `<AWS_IP>`, `<GCP_IP>`: Actual instance IP addresses

---

## Story Completion Criteria

Story 1.1 is **COMPLETE** when:

1. **All scripts created and tested**
   - [ ] verify_connectivity.sh runs successfully
   - [ ] setup_raft_storage.yml completes without errors
   - [ ] generate_node_configs.py creates all configs
   - [ ] measure_latency.sh generates report

2. **All nodes configured**
   - [ ] Storage directories exist
   - [ ] Config files deployed
   - [ ] Connectivity verified

3. **Documentation complete**
   - [ ] Setup guide written
   - [ ] Latency baseline documented
   - [ ] All deliverables checked in

4. **Performance targets met**
   - [ ] Intra-cloud latency <5ms
   - [ ] Cross-cloud latency <100ms
   - [ ] All nodes reachable

---

## Next Steps

After Story 1.1 completion, proceed to **Story 1.2: Raft Cluster Implementation**

**Story 1.2 Overview**:
- Implement HashiCorp Raft library integration
- Leader election and state transitions
- Log persistence (BoltDB backend)
- Network transport (TCP via gRPC)

**Branch**: `feature/raft-control-plane`

**Documentation**: See `docs/sprint1_raft_detailed.md`

---

## Time Estimate

| Task | Estimated Time |
|------|----------------|
| Script creation | ‚úÖ 1 hour (DONE) |
| inventory.ini setup | 10 minutes |
| Run connectivity tests | 10 minutes |
| Setup Raft storage | 5 minutes |
| Generate configs | 5 minutes |
| Deploy configs | 5 minutes |
| Measure latency | 10 minutes |
| Verification | 15 minutes |
| **Total** | **~2 hours** |

---

## Sign-Off

**Developer**: _________________
**Date**: _________________
**Reviewer**: _________________
**Date**: _________________

**Notes**:


---

**END OF CHECKLIST**
